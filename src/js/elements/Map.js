function Map(ops) {
	ops = ops || {};
	SquareImage.apply(this, arguments);
	this.pieceCounter = 0;
	this.key = ops.key;
	this._endGameCallback = null;
	this.visible = false;
	this.pieceTable = {};
}

Map.prototype = Object.create(SquareImage.prototype);

Map.prototype.NUM_PIECES = Piece.prototype.NAMES.length;

Map.prototype.NAMES = {
	'futuro': 'Futuro',
	'atual': 'Atual',
	'pangeia': 'Pangeia',
	'rodinia': 'Rod√≠nia'
};

Map.prototype.COORDS = {
	'futuro': {"AFR1":{"x":0.049548221714562204,"y":0.1693726338167814,"rot":0.9999999999999994},"AFR2":{"x":0.09114145548482445,"y":0.06051608332614787,"rot":0.005555555555551535},"AFR3":{"x":0.11047248949097734,"y":-0.02026487571754675,"rot":0.9999999999999994},"AFREU":{"x":0.11734265241853307,"y":0.2408659572274179,"rot":0.9999999999999994},"Antartida":{"x":-0.0791595686633901,"y":-0.27315101311809714,"rot":6.6261555863823264e-18},"AUS":{"x":0.3183976747912128,"y":-0.03415891946261306,"rot":0.9999999999999998},"CHINA1":{"x":0.22755572088731102,"y":0.17610975638160414,"rot":2.208718528794109e-18},"CHINA2":{"x":0.2688550072865977,"y":0.125386161836742,"rot":0.9999999999999994},"EU":{"x":0.18735273807642278,"y":0.2453286965002959,"rot":0.9999999999999999},"India":{"x":0.2114451285315075,"y":0.07884922239329961,"rot":0.9999999999999998},"NA":{"x":-0.18634929732679628,"y":0.2003844554675207,"rot":0.9999999999999994},"SA1":{"x":-0.32995292101078627,"y":-0.02459614661832642,"rot":6.6261555863823264e-18},"SA2":{"x":-0.27164496189178006,"y":-0.027846556403085452,"rot":6.6261555863823264e-18},"SA3":{"x":-0.3015908528354699,"y":-0.11439179428478419,"rot":0.9999999999999997}},
	'atual': {"AFR1":{"x":0.0022294099130283217,"y":0.07727744072333137,"rot":0.9666666666666665},"AFR2":{"x":0.05614130972054979,"y":-0.020090834661547506,"rot":0.9722222222222222},"AFR3":{"x":0.08414564019217276,"y":-0.0961008278653025,"rot":0.9722222222222215},"AFREU":{"x":0.051048952822287226,"y":0.22822601029371056,"rot":0.9999999999999998},"Antartida":{"x":0.04399276403085487,"y":-0.2759696066979019,"rot":0.9888888888888883},"AUS":{"x":0.31049194012691556,"y":-0.11349598905392762,"rot":0.9999999999999997},"CHINA1":{"x":0.22700048988472893,"y":0.18024326978444036,"rot":6.6261555863823264e-18},"CHINA2":{"x":0.2700538464012597,"y":0.1243647367104717,"rot":6.6261555863823264e-18},"EU":{"x":0.18739734891650972,"y":0.24571329918743554,"rot":0.9999999999999997},"India":{"x":0.21073831328812148,"y":0.08204912288686198,"rot":0.01},"NA":{"x":-0.1568397281807665,"y":0.22064443838878955,"rot":0.9722222222222222},"SA1":{"x":-0.17225122036886015,"y":-0.0320950516831429,"rot":0.9999999999999999},"SA2":{"x":-0.11257101681560006,"y":-0.03635315439695953,"rot":0.9944444444444445},"SA3":{"x":-0.1418779737201291,"y":-0.12380744028922128,"rot":0.994444444444444}},
	'pangeia': {"NA": {"x": -0.18637977164272845, "y": 0.23117491532868106}, "CHINA1": {"x": 0.24571767250782575, "y": 0.1720885745888408}, "CHINA2": {"x": 0.24571767250782575, "y": 0.1720885745888408}, "AFR1": {"x": 0.048207442490614504, "y": 0.19379390859972642}, "SA2": {"x": -0.27242512203256397, "y": -0.031930093609597324}, "AFR3": {"x": 0.11041210450597441, "y": -0.022775481677659543}, "AUS": {"x": 0.3175262690116946, "y": -0.03878383317294758}, "SA3": {"x": -0.30253377199357295, "y": -0.13245170133154127}, "EU": {"x": 0.18870568335829407, "y": 0.28331003006977035}, "SA1": {"x": -0.33057147457608227, "y": -0.029115428793955785}, "AFREU": {"x": 0.11763335147560428, "y": 0.27595204857035516}, "AFR2": {"x": 0.09164785483328294, "y": 0.06870061602719109}, "India": {"x": 0.21073831328812148, "y": 0.09104912288686198}, "Antartida": {"x": -0.08066113777938186, "y": -0.3146024665293112}},
	'rodinia': {"NA": {"x": -0.18637977164272845, "y": 0.23117491532868106}, "CHINA1": {"x": 0.24571767250782575, "y": 0.1720885745888408}, "CHINA2": {"x": 0.24571767250782575, "y": 0.1720885745888408}, "AFR1": {"x": 0.048207442490614504, "y": 0.19379390859972642}, "SA2": {"x": -0.27242512203256397, "y": -0.031930093609597324}, "AFR3": {"x": 0.11041210450597441, "y": -0.022775481677659543}, "AUS": {"x": 0.3175262690116946, "y": -0.03878383317294758}, "SA3": {"x": -0.30253377199357295, "y": -0.13245170133154127}, "EU": {"x": 0.18870568335829407, "y": 0.28331003006977035}, "SA1": {"x": -0.33057147457608227, "y": -0.029115428793955785}, "AFREU": {"x": 0.11763335147560428, "y": 0.27595204857035516}, "AFR2": {"x": 0.09164785483328294, "y": 0.06870061602719109}, "India": {"x": 0.21073831328812148, "y": 0.09104912288686198}, "Antartida": {"x": -0.08066113777938186, "y": -0.3146024665293112}}
};

Map.prototype.initForGameplay = function (endGameCallback) {
	this.visible = true;
	this.pieceCounter = 0;
	this.pieceTable = {};
	if (!(endGameCallback instanceof Function)) {
		throw "Undefined end game callback";
	}
	this._endGameCallback = endGameCallback;
};

Map.prototype.getPieceTarget = function getPieceTarget(pieceName) {
	return Map.prototype.COORDS[this.key][pieceName];
};

Map.prototype.incrPiece = function (pieceName) {
	if(!this.pieceTable[pieceName]) {
		this.pieceTable[pieceName] = true;
		this.pieceCounter++;
	}
};

Map.prototype.checkEndGame = function checkEndGame() {
	if(this.pieceCounter === Map.prototype.NUM_PIECES) {
		this._endGameCallback();
	}
};